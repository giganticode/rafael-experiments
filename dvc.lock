extract-devanbu-small-corpus:
  cmd: unzip devanbu-small-corpus.zip -d devanbu-small-corpus
  deps:
  - path: devanbu-small-corpus.zip
    md5: 53ef1189ccdc6a53b7545d06bbf13278
  outs:
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
training:
  cmd: jq "$(<to-fuzzy-sharp-config.jq)" config.json > params.json && virtualenv .venv
    && source .venv/bin/activate && LANGMODELS_COMMIT_HASH=$(<langmodels-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_COMMIT_HASH
    && langmodels train --config=$(pwd)/config.json --output-path=$(pwd)/output --patch="corpus.path=$(pwd)/devanbu-small-corpus"
    --rewrite-output --save-every-epoch; rm -rf .venv
  deps:
  - path: config.json
    md5: 0f22cb43b91673a30528f2758371c347
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-commit-hash.txt
    md5: 624c26ac32793002f97cfd44caaf95d8
  - path: to-fuzzy-sharp-config.jq
    md5: 3825af7e45f80d0f050b6f7a0f1f5313
  outs:
  - path: output/config
    md5: 325610e9acffef30c16fc53c3df0c0f4
  - path: output/epoch_0.pth
    md5: b48726fe57c50d02330b6d59b574f1e5
  - path: output/epoch_10.pth
    md5: 72db6ecac87e986362a1ccc1690b23d1
  - path: output/epoch_19.pth
    md5: 1c9e316a2dcff380d182c08768011f72
  - path: output/epoch_2.pth
    md5: 47f3928da5c22b03193dd603df6013d0
  - path: output/epoch_5.pth
    md5: 970293c0a27b13c75b04dbd2b9404972
  - path: output/epoch_79.pth
    md5: 4a7fa3de97abfd88913ddfb40e6dcf36
  - path: output/training_metrics.csv
    md5: f410094fcd03965ee640a63900ecb7f3
  - path: output/vocab
    md5: c5463963c945d04dcbcf3927ec3fb04c
evaluation:
  cmd: virtualenv .venv && source .venv/bin/activate && LANGMODELS_V2_COMMIT_HASH=$(<langmodels-v2-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_V2_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_V2_COMMIT_HASH
    && langmodels evaluate $(pwd)/output  -p $(pwd)/devanbu-small-corpus/valid -o
    $(pwd)/evaluation -b 64; rm -rf .venv
  deps:
  - path: output/best.pth
    md5: f2bd6a0afe7e5da93e2c79c3e51ca97b
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-v2-commit-hash.txt
    md5: 06c04948605698c77d7e248bb65f8576
  outs:
  - path: evaluation
    md5: 498a7aa750357061c3be9b9718a3ae35.dir
evaluation-test:
  cmd: virtualenv .venv && source .venv/bin/activate && LANGMODELS_V2_COMMIT_HASH=$(<langmodels-v2-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_V2_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_V2_COMMIT_HASH
    && langmodels evaluate $(pwd)/output  -p $(pwd)/devanbu-small-corpus/test -o $(pwd)/evaluation-test-0
    -b 64; rm -rf .venv
  deps:
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-v2-commit-hash.txt
    md5: 501d7799c83977aba7427cd1e397ef98
  - path: output/epoch_0.pth
    md5: 2e599659bdcd305e135ccc4993c26bb5
  outs:
  - path: evaluation-test-0
    md5: d3a25253ec38ab31bda4f7206c935312.dir
evaluation-test-19:
  cmd: virtualenv .venv && source .venv/bin/activate && LANGMODELS_V2_COMMIT_HASH=$(<langmodels-v2-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_V2_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_V2_COMMIT_HASH
    && langmodels evaluate $(pwd)/output  -p $(pwd)/devanbu-small-corpus/test -o $(pwd)/evaluation-test-19
    -b 64; rm -rf .venv
  deps:
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-v2-commit-hash.txt
    md5: 501d7799c83977aba7427cd1e397ef98
  - path: output/epoch_19.pth
    md5: b356cc430b4885b697be21d665dfd9bc
  outs:
  - path: evaluation-test-19
    md5: 7530c3a43807f3650f7faf64d5fc40c8.dir
evaluation-test-79:
  cmd: virtualenv .venv && source .venv/bin/activate && LANGMODELS_V2_COMMIT_HASH=$(<langmodels-v2-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_V2_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_V2_COMMIT_HASH
    && langmodels evaluate $(pwd)/output  -p $(pwd)/devanbu-small-corpus/test -o $(pwd)/evaluation-test-79
    -b 64; rm -rf .venv
  deps:
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-v2-commit-hash.txt
    md5: 501d7799c83977aba7427cd1e397ef98
  - path: output/epoch_79.pth
    md5: 4a7fa3de97abfd88913ddfb40e6dcf36
  outs:
  - path: evaluation-test-79
    md5: a4fd5dfe318267010b8acb1c918a642b.dir
