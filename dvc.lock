extract-devanbu-small-corpus:
  cmd: unzip devanbu-small-corpus.zip -d devanbu-small-corpus
  deps:
  - path: devanbu-small-corpus.zip
    md5: 53ef1189ccdc6a53b7545d06bbf13278
  outs:
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
training:
  cmd: jq "$(<to-fuzzy-sharp-config.jq)" config.json > params.json && virtualenv .venv
    && source .venv/bin/activate && LANGMODELS_COMMIT_HASH=$(<langmodels-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_COMMIT_HASH
    && langmodels train --config=$(pwd)/config.json --output-path=$(pwd)/output --patch="corpus.path=$(pwd)/devanbu-small-corpus"
    --rewrite-output; rm -rf .venv
  deps:
  - path: config.json
    md5: 98bee909427b4c4c5823b721b39e35f7
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-commit-hash.txt
    md5: be4f65073f239b49ffd8b8ec31d10888
  - path: to-fuzzy-sharp-config.jq
    md5: 3825af7e45f80d0f050b6f7a0f1f5313
  outs:
  - path: output/best.pth
    md5: 3fb62b451ffbda6245b4efcaf4e4e359
  - path: output/config
    md5: c54f4b65bd3969c0257b56f50e3888bf
  - path: output/training_metrics.csv
    md5: 36c2e17bddfb1985dd3ae2699de22da1
  - path: output/vocab
    md5: aba24cefec82fe4f88183d35b6b6c4b1
evaluation:
  cmd: virtualenv .venv && source .venv/bin/activate && LANGMODELS_V2_COMMIT_HASH=$(<langmodels-v2-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_V2_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_V2_COMMIT_HASH
    && langmodels evaluate $(pwd)/output  -p $(pwd)/devanbu-small-corpus/valid -o
    $(pwd)/evaluation -b 64; rm -rf .venv
  deps:
  - path: output/best.pth
    md5: f2bd6a0afe7e5da93e2c79c3e51ca97b
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-v2-commit-hash.txt
    md5: 06c04948605698c77d7e248bb65f8576
  outs:
  - path: evaluation
    md5: 498a7aa750357061c3be9b9718a3ae35.dir
evaluation-test:
  cmd: virtualenv .venv && source .venv/bin/activate && LANGMODELS_V2_COMMIT_HASH=$(<langmodels-v2-commit-hash.txt)
    && pip install -r https://raw.githubusercontent.com/giganticode/langmodels/$LANGMODELS_V2_COMMIT_HASH/requirements.txt
    && pip install git+https://github.com/giganticode/langmodels@$LANGMODELS_V2_COMMIT_HASH
    && langmodels evaluate $(pwd)/output  -p $(pwd)/devanbu-small-corpus/test -o $(pwd)/evaluation-test
    -b 64; rm -rf .venv
  deps:
  - path: devanbu-small-corpus
    md5: fbfc6bc25a11e40705a235b12e9f0637.dir
  - path: langmodels-v2-commit-hash.txt
    md5: 06c04948605698c77d7e248bb65f8576
  - path: output/best.pth
    md5: 3fb62b451ffbda6245b4efcaf4e4e359
  outs:
  - path: evaluation-test
    md5: 106a55dba71cfd7c6885abbf4ba9a137.dir
